# AutoReportBed

网页端微信自动报寝脚本，在设定的时刻向选定联系人发送消息。

This is a script running at WeChat-web which aims at sending bed-checking message at a certain time.

## 功能

+ 定时发送控件，在22:31-34:00-59范围内随机选择一个时刻，可根据需要进行修改。
+ 消息输入框自动填入默认报寝信息，在定时发送之前可以修改。
+ 点击确认按钮挂载定时发送任务，显示发送倒计时。
+ 点击取消按钮可卸载定时发送任务。
+ 对时间的输入进行了字符串过滤，只允许输入1到2位数字字符。

## 使用方法

1. 登录网页端微信。
2. 点击选择待发送联系人。
3. 在浏览器中打开js控制台。

![运行效果](https://github.com/RSencoder/AutoReportBed/blob/master/%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C1.png)

4. 复制粘贴脚本，回车运行。

## 注意事项

+ 如果定时发送时刻早于现在时刻，按下确认按钮就会立即发送。
+ 保持网页的持续活动。
+ 只在firefox下进行充分测试。

## 已知问题

+ 挂载定时发送任务后，如果新建或切换到其他标签页进行浏览及操作，再切回网页端微信，可能会发现倒计时变慢。表现为现在时刻加上倒计时时间大于发送时刻。推测原因是js是单线程语言，setTimeout()方法不能保证到点一定会调用，只是将任务挂载进入任务队列。在其他标签页运行js时，倒计时所用的setTimeout()没有按时调用或没有调用，导致totalms变量没有按时减去1000。
+ 如果倒计时时间较长，定时发送可能会延后。原因同上。
+ 输入框编辑，按下退格键光标跳动，或者连续按两次才有效果。
